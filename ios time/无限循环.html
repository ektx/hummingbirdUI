<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Demo</title>
	<style>
	.mod {
		width: 300px;
		height: 300px;
		margin: 200px auto;
		border: 2px solid #000;
		/*overflow: hidden*/
	
	}
	.box{
		position: relative;
		height: 100%;
	}
	.child {
		position: absolute;
		top: 0;
		width: 420px;
		height: 100%;
		opacity: .8;
		z-index: 1
	}
	.red {
		background: red
	}
	.yellow {
		background: yellow;
	}

	.current {
		top: 0;
	}
	</style>
</head>
<body>
	<div class="mod">
		<div class="box">
			<div class="child red current"></div>
			<div class="child yellow ready" style="transform: translatex(420px)"></div>
		</div>
	</div>


	<ul style="position: fixed; top: 0">
		<li id="newBoxPosX-s"></li>
		<li ><span id="zf"></span></li>
	</ul>
	<script src="jquery.js"></script>
	<script>
	var startX = 0, currentY, boxPositionY;
	$('.mod')
	.mousedown(function(e) {
		console.log(e)
		startX = e.originalEvent.layerX;

		// 获取当前的位置信息
		boxPositionX = getTransForm('.box')

		console.log('原始位置：'+startX )
	
	})
	.mousemove(function(e) {
		if (e.buttons === 1) {
			var move = e.originalEvent.layerX - startX
			var newBoxPosX = boxPositionX + move;

			var start_X = newBoxPosX

			$('#newBoxPosX-s').text(newBoxPosX)

			$('.child').each(function(index) {
				var iPositionX = getTransForm($(this));

				// 相对开始位置
				var relativeX = iPositionX + newBoxPosX;
				// 相对结束位置
				var relativeE = relativeX + 420;

				console.log(index, '开始点:', relativeX)
				console.log(index, '结束点:', relativeE)


				// 我们来判断开始点的位置
				// 如果是在 0 到 300 那么,一定是在显示区中
				// 此时只有开始的部分能看到
				if (relativeX > 0 && relativeX < 300) {
					console.log('在之间,部分显示')
				} 
				// 如果不在 0 到 300 之间
				// 那么可能是在 0 前,那就是移动到了左边
				// 要么在 300 之后,移动到了右边
				else {

					// 如果是在 0 前面
					if (relativeX < 0 ) {

						// 那么我们看下结束点在那
						// 如果结束点 > 0,那就是在显示区中
						if (relativeE > 0) {
							
							// ::这里主要是状态说明,并没有实际作用
							// 如果还大于 300 那就是全部显示中,独占显示区
							if (relativeE > 300) {
								console.log('全部显示中')
							} 
							// 反之则是只有尾部部分在了,快要结束或只是开始
							else {
								console.log('尾部显示中')
							}
						}

						// 如果小于 0,那么说明它整个都已经移过了显示区
						else {

							// 我们设置一个缓冲
							// 不用让它一过显示区就移动位置
							// 万一用户马上回来又要移动位置,这样操作太频繁了
							var buffer = 0 - (420 - 300)/2;

							// 当结束点也小于缓冲区了,开始移动到新位置上
							if (relativeE < buffer) {

								$(this).css({
									transform: 'translate3d('+(iPositionX+ 420 *2)+'px,0,0)'
								})

							}
							
						}


					} 

					// 如果当前位置在 300 之后
					// 那它就看不见
					else if (relativeX > 300 ) {

						var buffer = (420 - 300)/2 + 300;

						// 同时它还在可视位置后的缓冲之外
						// 那它直接移动新位置上
						if (relativeX > buffer) {

							$(this).css({
								transform: 'translate3d('+(iPositionX- 420 *2)+'px,0,0)'
							})
						}
					}
				}

			})

			// 设置顶层移动距离
			$('.box').css({
				transform: 'translate3d('+newBoxPosX+'px, 0,0)'
			})

		}
	});
	

	function getTransForm (element) {
		var getTransForm = $(element).css('transform');
		getTransForm = getTransForm == 'none' ? 'matrix(1, 0, 0, 1, 0, 0)' : getTransForm; 
		
		return Number(getTransForm.split(',')[4].replace(')',''));		
	}
	</script>
</body>
</html>